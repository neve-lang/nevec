# This benchmark stresses both field and method lookup.

rec Foo
  field0 Int
  field1 Int
  field2 Int
  field3 Int
  field4 Int
  field5 Int
  field6 Int
  field7 Int
  field8 Int
  field9 Int
  field10 Int
  field11 Int
  field12 Int
  field13 Int
  field14 Int
  field15 Int
  field16 Int
  field17 Int
  field18 Int
  field19 Int
  field20 Int
  field21 Int
  field22 Int
  field23 Int
  field24 Int
  field25 Int
  field26 Int
  field27 Int
  field28 Int
  field29 Int
end

idea for Foo
  fun Foo.new
    Foo with
      field0 = 1
      field1 = 1
      field2 = 1
      field3 = 1
      field4 = 1
      field5 = 1
      field6 = 1
      field7 = 1
      field8 = 1
      field9 = 1
      field10 = 1
      field11 = 1
      field12 = 1
      field13 = 1
      field14 = 1
      field15 = 1
      field16 = 1
      field17 = 1
      field18 = 1
      field19 = 1
      field20 = 1
      field21 = 1
      field22 = 1
      field23 = 1
      field24 = 1
      field25 = 1
      field26 = 1
      field27 = 1
      field28 = 1
      field29 = 1
    end
  end

  fun method0
    self.field0
  end

  fun method1
    self.field1
  end

  fun method2
    self.field2
  end

  fun method3
    self.field3
  end

  fun method4
    self.field4
  end

  fun method5
    self.field5
  end

  fun method6
    self.field6
  end

  fun method7
    self.field7
  end

  fun method8
    self.field8
  end

  fun method9
    self.field9
  end

  fun method10
    self.field10
  end

  fun method11
    self.field11
  end

  fun method12
    self.field12
  end

  fun method13
    self.field13
  end

  fun method14
    self.field14
  end

  fun method15
    self.field15
  end

  fun method16
    self.field16
  end

  fun method17
    self.field17
  end

  fun method18
    self.field18
  end

  fun method19
    self.field19
  end

  fun method20
    self.field20
  end

  fun method21
    self.field21
  end

  fun method22
    self.field22
  end

  fun method23
    self.field23
  end

  fun method24
    self.field24
  end

  fun method25
    self.field25
  end

  fun method26
    self.field26
  end

  fun method27
    self.field27
  end

  fun method28
    self.field28
  end

  fun method29
    self.field29
  end
end

fun main
  let foo = Foo with .?.

  let start = clock

  500000.times do
    foo.method0
    foo.method1
    foo.method2
    foo.method3
    foo.method4
    foo.method5
    foo.method6
    foo.method7
    foo.method8
    foo.method9
    foo.method10
    foo.method11
    foo.method12
    foo.method13
    foo.method14
    foo.method15
    foo.method16
    foo.method17
    foo.method18
    foo.method19
    foo.method20
    foo.method21
    foo.method22
    foo.method23
    foo.method24
    foo.method25
    foo.method26
    foo.method27
    foo.method28
    foo.method29
  end

  puts "#{clock - start}ms."
end
